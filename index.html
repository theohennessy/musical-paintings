<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Musical Paintings</title>
<style>
  body {
    margin: 0;
    font-family: sans-serif;
    background: #FFF;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }

  #container {
    position: relative;
    width: 100%;
  }

  #BG {
    width: 100%;
    display: block;
  }

  /* Start button overlay */
  #startOverlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.6);
    display: flex;
    justify-content: center;
    align-items: center;
    color: #FFF;
    font-size: 2rem;
    cursor: pointer;
    z-index: 10;
  }

  .hotspot {
    position: absolute;
    border-radius: 12px;
    cursor: pointer;
  }

  #HS1 { width: 180px; height: 120px; }
  #HS2 { width: 180px; height: 90px; }
  #HS3 { width: 120px; height: 90px; }

  .overlay {
    position: absolute;
    width: 100%;
    top: 0;
    left: 0;
    opacity: 0;
    pointer-events: none;
    transition: opacity 1s ease;
  }
  .overlay.visible {
    opacity: 1;
  }

  audio { display: none; }
</style>
</head>
<body>

<div id="container">
  <img id="BG" src="BG.png" />

  <div id="HS1" class="hotspot" style="top:54%; left:74%;"></div>
  <div id="HS2" class="hotspot" style="top:52%; left:56%;"></div>
  <div id="HS3" class="hotspot" style="top:50%; left:25%;"></div>

  <img id="IMG1" class="overlay" src="IMG1.png" />
  <img id="IMG2" class="overlay" src="IMG2.png" />
  <img id="IMG3" class="overlay" src="IMG3.png" />

  <audio id="MP31" src="MP31.mp3" muted playsinline preload="auto"></audio>
  <audio id="MP32" src="MP32.mp3" muted playsinline preload="auto"></audio>
  <audio id="MP33" src="MP33.mp3" muted playsinline preload="auto"></audio>

  <div id="startOverlay">Start</div>
</div>

<script>
const audios = ["MP31","MP32","MP33"].map(id => document.getElementById(id));
let audioStarted = false;
const startOverlay = document.getElementById("startOverlay");

// Start all audio on first user gesture
function startAudio(event) {
  if (audioStarted) return;

  audios.forEach(audio => {
    audio.muted = true; // unmute for mobile
    audio.volume = 0;
    audio.play().catch(e => alert(e));
  });

  audioStarted = true;
  startOverlay.style.display = "none";
}

// Bind start button
startOverlay.addEventListener("click", startAudio);

// Hotspot toggle logic
function bindToggle(hsId, imgId, audioIndex) {
  const hs = document.getElementById(hsId);
  const img = document.getElementById(imgId);
  const audio = audios[audioIndex];
  let visible = false;

  function toggle(event) {
    event.preventDefault();
    if (!audioStarted) return; // ignore until audio started
    visible = !visible;
    img.classList.toggle("visible", visible);
    fadeAudio(audio, visible ? 1 : 0, visible ? 200 : 300);
  }

  hs.addEventListener("click", toggle);
  hs.addEventListener("touchstart", toggle, { passive: false });
}

// Audio fade helper
function fadeAudio(audio, target, duration) {
    
  if (target === 1) audio.muted = false;
  const steps = 8;
  const stepTime = duration / steps;
  const start = audio.volume;
  const diff = target - start;
  let i = 0;

  const fade = setInterval(() => {
    i++;
    audio.volume = start + diff * (i/steps);
    if (i >= steps) {
      clearInterval(fade);
      if (target === 0) audio.muted = true;
    }
  }, stepTime);
}

// Bind hotspots
bindToggle("HS1", "IMG1", 0);
bindToggle("HS2", "IMG2", 1);
bindToggle("HS3", "IMG3", 2);
</script>

</body>
</html>
